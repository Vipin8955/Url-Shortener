<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
   <div class="mainContainer">
    <button id="logoutbtn"><a href="/logout">logout</a></button>
     <div class="formCOntainer">
        <form  method="post" action="/url/shorturl">
        <label>Enter your url</label><input name="redirectUrl" type="url" required>
        <button type="submit">Submit</button>
    </form>
     </div>
   <div class="analyticsContainer">
    <% if (urls && urls.length > 0){ %>
        <table id="urlTable" border="1" cellspacing="10" cellpadding="5">
           <tr>
            <th>S. NO.</th>
            <th>ShortUrl</th>
            <th>RedirectUrl</th>
            <th>TotalClicks</th>
           </tr>
            <% urls.forEach((url,index) => { %>
                <tr>
                    <td><%=index+1 %></td>
                    <td><a href="/url/<%= url.shortId %>"><%= url.shortId %></a></td>
                    <td class="redirect" title="<%= url.redirectUrl %>"><%=url.redirectUrl %></td>
                    <td><%=url.visitHistory.length %></td>
                    <td><button type="button" class="deleteBtn" id= "<%=url._id%>" >delete</button></td>
                </tr>
                
            <% }) %>
        </table>
    <% } %>
   </div>
   </div>
   <script>
        const deleteBtns = document.querySelectorAll('.deleteBtn');
       
        
deleteBtns.forEach(btn => {
  btn.addEventListener('click', async (event) => {
    const id = event.target.id;
    const response = await fetch(`/url/delete/${id}`, {
      method: 'POST'
    });
    if (response.ok) {
      const row = event.target.closest('tr');
      row.remove();
    } else {
      alert("Failed to delete URL");
    }
    const table = document.getElementById('urlTable');
    const remainingRows = table.querySelectorAll('tr').length;
    if (remainingRows === 1) {
       table.remove();
    }
  });
});

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      window.location.reload();
    }
  });



   </script>
</body>
</html>